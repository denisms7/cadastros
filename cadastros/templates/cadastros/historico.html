
{% extends "base.html" %}

{% block pagina %}
{% load static %}

<div class="container">
    <div class="d-flex justify-content-between">
        <div>
            <h2>
                <i class="bi bi-journal-text"></i>
                Log de Alterações
            </h2>
        </div>
        <div>
            <button type="button" onclick="window.history.go(-1)" class="btn btn-primary my-1">
                <i class="bi bi-arrow-return-left me-1"></i>Voltar
            </button>
        </div>
    </div>
</div>

<div class="container">
    <hr>
</div>

<div class="container mt-4">
    <p class="">
        {{ cadastro }}  
    </p>


{% for h in page_obj %}
<div class="accordion mb-1" id="historicoAccordion">
    <div class="accordion-item">
        <h2 class="accordion-header" id="heading{{ forloop.counter }}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="false" aria-controls="collapse{{ forloop.counter }}">
                <div class="m-0 d-flex justify-content-between gap-2 align-items-center">
                    <div class="d-flex align-items-center gap-4">
                        <span class="me-2">
                            {% if h.item.history_type == '+' %}
                                <i class="bi bi-plus-circle-fill text-success"></i>
                            {% elif h.item.history_type == '~' %}
                                <i class="bi bi-pencil-fill text-warning"></i>
                            {% elif h.item.history_type == '-' %}
                                <i class="bi bi-trash-fill text-danger"></i>
                            {% endif %}
                        </span>
                        {{ h.item.history_date|date:"d/m/Y H:i" }}
                        <span class="ms-2 fw-bold">
                            {% if h.item.history_type == '+' %} Criado
                            {% elif h.item.history_type == '~' %} Alterado
                            {% elif h.item.history_type == '-' %} Deletado
                            {% endif %}
                        </span>
                        <span class="ms-auto text-muted"> Usuário: {{ h.item.history_user|default:"Sistema" }}</span>
                    </div>
                </div>
            </button>
        </h2>
        <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#historicoAccordion">
            <div class="accordion-body">
                {% if h.diff %}
                    <ul class="list-group list-group-flush">
                        {% for change in h.diff %}
                        <li class="list-group-item d-flex align-items-center gap-2">
                            <strong>{{ change.verbose_name }}:</strong>
                            <div>
                                <span class="text-danger">{{ change.old }}</span>
                                <i class="bi bi-arrow-right mx-1"></i>
                                <span class="text-success">{{ change.new }}</span>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted">Sem alterações (registro inicial ou sem comparação).</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endfor %}



</div>

<div class="container mt-3">
    <button type="button" onclick="window.history.go(-1)" class="btn btn-primary my-1">
        <i class="bi bi-arrow-return-left me-1"></i>Voltar
    </button>
</div>

{% include "paginacao.html" %}

{% endblock %}
