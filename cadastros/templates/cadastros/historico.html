
{% extends "base.html" %}

{% block pagina %}

<div class="container mt-4">
    <h2>Histórico de Alterações - {{ cadastro }}</h2>

    {% for h in historico_com_diffs %}


    <div class="accordion mb-1" id="historicoAccordion">
    <div class="accordion-item">
        <h2 class="accordion-header" id="heading{{ forloop.counter }}">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="false" aria-controls="collapse{{ forloop.counter }}">
            <p class="m-0">
            {{ h.item.history_date|date:"d/m/Y H:i" }} -  
                    {% if h.item.history_type == '+' %}
                        <span class="fw-bold">Criado</span>
                    {% elif h.item.history_type == '~' %}
                        <span class="fw-bold">Alterado</span>
                    {% elif h.item.history_type == '-' %}
                        <span class="fw-bold">Deletado</span>
                    {% endif %}
                <span> - Usuário: {{ h.item.history_user|default:"Sistema" }}</span>
            </p>
        </button>
        </h2>
        <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#historicoAccordion">
        <div class="accordion-body">
            {% if h.diff %}
            <ul class="list-group list-group-flush">
                {% for change in h.diff.changes %}
                <li class="list-group-item">
                    <strong>{{ change.field }}:</strong>
                    <span class="text-danger">{{ change.old }}</span>
                    →
                    <span class="text-success">{{ change.new }}</span>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="text-muted">Sem alterações (registro inicial ou sem comparação).</p>
            {% endif %}
        </div>
        </div>
    </div>
    </div>



    {% endfor %}
</div>
{% endblock %}
